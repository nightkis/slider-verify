!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).sverify={})}(this,(function(e){"use strict";function n(e){const n=e.prefix,t=e.dom,o=e.style,i=e.c_w,s=e.c_h,a=e.panelDom();t?a.querySelector(`#${n}`)||a.querySelector("body").appendChild(e.dom):e.dom=function(e,n,t,o){const i=document.createElement("div");i.classList.add(`${e}-bt-pointer`,`${e}-refresh`),i.setAttribute("id",`${e}_refresh_bt`),i.innerHTML='\n        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"\n        data-v-ea893728=""><path fill="currentColor"\n        d="M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"></path></svg>\n    ';const s=document.createElement("div");return s.setAttribute("class",e),s.setAttribute("id",e),s.innerHTML=`\n        <div id="${e}_canvas_containe">\n            <canvas id="${e}_bg_canvas" width="${n}" height="${t}"></canvas>\n            <canvas id="${e}_block_canvas" width="${n}" height="${t}"></canvas>\n            <div id="${e}_canvas_containe_loading">加载中...</div>\n            <div id="${e}_result_info"></div>\n        </div>\n        <div class="${e}-slide-box">\n            <span id="${e}_placehold">拖动滑块完成拼图</span>\n            <span id="${e}_slide_bt">\n                <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"\n                data-v-ea893728=""><path fill="currentColor"\n                d="M452.864 149.312a29.12 29.12 0 0 1 41.728.064L826.24 489.664a32 32 0 0 1 0 44.672L494.592 874.624a29.12 29.12 0 0 1-41.728 0 30.592 30.592 0 0 1 0-42.752L764.736 512 452.864 192a30.592 30.592 0 0 1 0-42.688zm-256 0a29.12 29.12 0 0 1 41.728.064L570.24 489.664a32 32 0 0 1 0 44.672L238.592 874.624a29.12 29.12 0 0 1-41.728 0 30.592 30.592 0 0 1 0-42.752L508.736 512 196.864 192a30.592 30.592 0 0 1 0-42.688z"></path></svg>\n            </span>\n        </div>\n        <div class="${e}-tool-box">\n            ${i.outerHTML}\n        </div>\n    `,o.appendChild(s),s}(n,i,s,a),o?a.querySelector(`#${n}_class`)||a.querySelector("head").appendChild(e.style):e.style=function(e){const n=document.createElement("style");return n.setAttribute("id",`${e}_class`),n.innerText=`\n        .${e} {\n            position: relative;\n            display: inline-block;\n            padding: 10px;\n            border: 1px solid #ccc;\n            border-radius: 2px;\n            background: #fff;\n        }\n        .${e} svg {\n            width: 1em;\n            height: 1em;\n        }\n        .${e}-bt-pointer {\n            cursor: pointer;\n        }\n        .${e}-hide {\n            display: none !important;\n        }\n        #${e}_canvas_containe {\n            position: relative;\n            display: inline-block;\n            width: 300px;\n            height: 150px;\n        }\n        #${e}_canvas_containe_loading {\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            display: flex;\n            align-items: center;\n            justify-content: center;     \n            color: #a3abb3;\n            background: #fff; \n        }\n        #${e}_block_canvas {\n            position: absolute;\n            top: 0;\n            left: 0;\n        }\n        .${e}-slide-box {\n            width: 100%;\n            height: 40px;\n            margin-top: 15px;\n            border-radius: 20px;\n            background: #dfe0e1;\n            position: relative;\n            color: #a3abb3;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            user-select: none;\n        }\n        #${e}_slide_bt {\n            width: 50px;\n            height: 50px;\n            border-radius: 50px;\n            position: absolute;\n            left: 0;\n            background: #fff;\n            border: 1px solid #d0d0d0;\n            cursor: pointer;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            font-size: 30px;\n            z-index: 4;\n        }\n        #${e}_placehold {\n            transition: opacity .1s;\n            user-select: none;\n        }\n        #${e}_result_info {\n            width: 100%;\n            position: absolute;\n            left: 0;\n            bottom: -1em;\n            opacity: 0;\n            transition: all .3s;\n            text-align: center;\n            background: #ffffffdd;\n        }\n        .${e}-result-success {\n            color: green;\n        }\n        .${e}-result-failed {\n            color: red;\n        }\n        .${e}-tool-box {\n            position: absolute;\n            top: 10px;\n            right: 10px;\n            display: none;\n        }\n        .${e}-refresh {\n            display: inline-block;\n            color: #888;\n            font-size: 24px;\n        }\n    `,document.querySelector("head").appendChild(n),n}(n)}function t(e){const n=e.imgs;if(!n||!n.length)return void console.warn("img 为空");const t={value:null};!function(e,n){const{prefix:t,accuracy:i,dom:l,c_w:c,b_w:r,b_r:d}=n,u=l.querySelector(`#${t}_slide_bt`),f=l.querySelector(`#${t}_block_canvas`),p=l.querySelector(`#${t}_refresh_bt`),h=l.querySelector(`#${t}_placehold`);let m=0;u.addEventListener("mousedown",_),p.addEventListener("click",w);let y=0,v=!1;function _(n){null!=e.value&&(v=n.isTrusted,null==n.isTrusted&&(v=!0),y=n.clientX,document.addEventListener("mousemove",g),document.addEventListener("mouseup",b),m=+new Date)}function b(t){let o=t.clientX-y;const l=e.value;if(v&&o>l-i&&o<l+i){console.log("校验通过");let e=+new Date-m;e=Math.round(e/10)/100,n.success(e),a(n,"success")}else console.log("校验失败"),n.fail(),a(n,"failed"),setTimeout((()=>{s(e,n),u.style.left="0px",f.style.left="0px",y=0,h.style.opacity=1}),500);e.value,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",b)}function g(n){const t=c-r-d-i;let o=n.clientX-y;o>t||o<0||(u.style.left=o+"px",f.style.left=o+"px",h.style.opacity=1-o/e.value)}function w(t){s(e,n)}h.style.opacity=1,o=()=>{u.removeEventListener("mousedown",_),p.removeEventListener("click",w)}}(t,e),s(t,e)}let o=()=>{};function i(e,n,t,o){const{c_w:i,c_h:s,accuracy:a}=o,l=o.b_w,c=o.b_r,r=l+c+2*a,d=Math.floor(Math.random()*(i-3*r)+1.5*r),u=Math.floor(Math.random()*(s-1.5*r)+.4*r),f=Math.PI,p=o.prefix;function h(n){let i=t.querySelector("#"+n);const s=o.c_w,a=o.c_h;let r=i.getContext("2d",{willReadFrequently:!0});r.clearRect(0,0,s,a),n===`${p}_bg_canvas`?(r.drawImage(e,0,0,s,a),m(r)):(i.width=s,m(r,"clip"),r.drawImage(e,0,0,s,a),function(e,n){m(e,"border");const t=l+c+2,o=u-c-2,i=e.getImageData(d,o,t,t);n.width=t,e.putImageData(i,0,o)}(r,i))}function m(e,n){let t="clip"===n?-1:0;const o=l-2*t,i=d+t,s=u+t;e.beginPath(),e.moveTo(i,s),e.lineTo(i+o/2-c,s),e.arc(i+o/2,s,c,1*f,0),e.lineTo(i+o/2+c,s),e.lineTo(i+o,s),e.lineTo(i+o,s+o/2-c),e.arc(i+o,s+o/2,c,1.5*f,.5*f),e.lineTo(i+o,s+o/2+c),e.lineTo(i+o,s+o),e.lineTo(i,s+o),e.lineTo(i,s+o/2+c),e.arc(i,s+o/2,c,.5*f,1.5*f,!0),e.lineTo(i,s+o/2-c),e.closePath(),"clip"===n&&e.clip(),"border"!==n&&(e.fillStyle="#ffffffca",e.fill()),e.lineWidth=2,e.strokeStyle="#ffa736ca",e.shadowBlur=6,e.shadowColor="#ffa736",e.stroke()}h(`${p}_bg_canvas`),h(`${p}_block_canvas`),n.value=d}function s(e,n){const{dom:t,prefix:o,imgs:s}=n,a=t.querySelector(`#${o}_canvas_containe_loading`);a.classList.remove(`${o}-hide`);const l=Math.floor(Math.random()*s.length);var c;(c=s[l],new Promise(((e,n)=>{const t=new Image;t.onload=()=>{e(t)},t.onerror=e=>{n(e)},t.crossOrigin="Anonymous",t.src=c}))).then((s=>{a.classList.add(`${o}-hide`),i(s,e,t,n)}))}function a(e,n){const{dom:t,prefix:o}=e,i=t.querySelector(`#${o}_result_info`);i.innerHTML="success"===n?`\n            <span class="${o}-result-success">验证通过</span>\n        `:`\n            <span class="${o}-result-failed">验证失败</span>\n        `,i.style.bottom=0,i.style.opacity=1,setTimeout((()=>{i.style.bottom="-1em",i.style.opacity=0}),1e3)}class l{constructor({imgs:e=[],c_w:n=300,c_h:t=150,b_w:o=36,b_r:i=8,accuracy:s=5,panelDom:a=(()=>document.querySelector("body")),success:l=(()=>{}),fail:c=(()=>{})}={}){this.imgs=e,this.c_w=n,this.c_h=t,this.b_w=o,this.b_r=i,this.accuracy=s,this.panelDom=a,this.success=l,this.fail=c,this.prefix="my-slider-verify"}init(){n(this),t(this)}clear(){this.dom&&this.dom.parentNode.removeChild(this.dom),this.style&&this.style.parentNode.removeChild(this.style),o()}destroy(){}}e.createVerify=function(e){const n=new l(e);return n.init(),n},e.sequence=function(e){const n=[39,38,48,49,41,40,46,47,35,34,50,51,33,32,28,29,27,26,36,37,31,30,44,45,43,42,12,13,23,22,14,15,21,20,8,9,25,24,6,7,3,2,0,1,11,10,4,5,19,18,16,17],t=312,o=160,i=12,s=80;return new Promise(((n,t)=>{if("string"==typeof e){const o=new Image;return o.onload=()=>{n(a(o))},o.onerror=e=>{t("[sequence]",e)},o.src=e,void(o.crossOrigin="Anonymous")}n(a(e))}));function a(e){let a=document.createElement("canvas"),l=a.getContext("2d"),c=function(){let e=[];for(let n=0;n<o/s;n++)for(let o=0;o<t/i;o++){let a={num:o+n*(t/i),id:[o,n],sw:i-2,sh:s,sx:o*i+.5,sy:n*s,w:i,h:s,x:o*i,y:n*s};e.push(a)}return e}();return l.width=t,l.height=o,n.forEach(((n,t)=>{let o={...c[t]};o.sx=c[n].sx,o.sy=c[n].sy,l.drawImage(e,o.sx,o.sy,o.sw,o.sh,o.x,o.y,o.w,o.h)})),a.toDataURL()}}}));
